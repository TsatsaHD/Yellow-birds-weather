<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DHL Aviation Weerinfo</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
    }
    header {
      background-color: #FFD700;
      padding: 20px;
      text-align: center;
      border-bottom: 5px solid #D2042D;
    }
    header h1 {
      margin: 0;
      color: #8B0000;
    }
    .search-results, .stations {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .station {
      background: white;
      border: 2px solid #D2042D;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .station h2 {
      margin-top: 0;
      color: #D2042D;
      font-size: 1.2em;
    }
    .station pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: monospace;
      font-size: 0.9em;
      border: 1px solid #ddd;
    }
    .stations-selector {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 20px;
      background-color: #eee;
      border-bottom: 1px solid #ccc;
    }
    .station-button {
      background-color: #FFD700;
      border: 2px solid #D2042D;
      color: #8B0000;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s ease-in-out;
    }
    .station-button:hover {
      background-color: #ffe066;
    }
    .custom-header {
      background-color: #D2042D;
      padding: 10px;
      text-align: center;
    }
    .custom-header button {
      background-color: #D2042D;
      color: #FFD700;
      border: 2px solid #FFD700;
      border-radius: 6px;
      padding: 10px 20px;
      margin: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .custom-header button:hover {
      background-color: #a6001a;
    }
  </style>
</head>
<body>
  <header>
    <h1>DHL Aviation â€“ Weerinfo</h1>
  </header>
  
  <div class="custom-header">
    <button onclick="loadPreset('week')">Week</button>
    <button onclick="loadPreset('vrijdag')">Vrijdag</button>
    <button onclick="loadPreset('zondag')">Zondag</button>
  </div>

  <section class="stations-selector" id="stationsSelector"></section>
  <section class="stations" id="stationsOutput"></section>

  <script>
    const stations = [
      { name: "Bahrein", icao: "OBBI", iata: "BAH" },
      { name: "Barcelona", icao: "LEBL", iata: "BCN" },
      { name: "Basel", icao: "LFSB", iata: "BSL" },
      { name: "Bologna", icao: "LIPE", iata: "BLQ" },
      { name: "Bordeaux", icao: "LFBD", iata: "BOD" },
      { name: "Brussel", icao: "EBBR", iata: "BRU" },
      { name: "Budapest", icao: "LHBP", iata: "BUD" },
      { name: "Casablanca", icao: "GMMN", iata: "CMN" },
      { name: "Cincinnati", icao: "KCVG", iata: "CVG" },
      { name: "Dublin", icao: "EIDW", iata: "DUB" },
      { name: "East-Midlands", icao: "EGNX", iata: "EMA" },
      { name: "Hongkong", icao: "VHHH", iata: "HKG" },
      { name: "Keulen", icao: "EDDK", iata: "CGN" },
      { name: "Kopenhagen", icao: "EKCH", iata: "CPH" },
      { name: "Lagos", icao: "DNMM", iata: "LOS" },
      { name: "Leipzig", icao: "EDDP", iata: "LEJ" },
      { name: "Linz", icao: "LOWL", iata: "LNZ" },
      { name: "Londen", icao: "EGGW", iata: "LTN" },
      { name: "Lyon", icao: "LFLL", iata: "LYS" },
      { name: "Madrid", icao: "LEMD", iata: "MAD" },
      { name: "Malpensa", icao: "LIMC", iata: "MXP" },
      { name: "Marseille", icao: "LFML", iata: "MRS" },
      { name: "Mulhouse", icao: "LFSB", iata: "MLH" },
      { name: "Parijs", icao: "LFPG", iata: "CDG" },
      { name: "Porto", icao: "LPPR", iata: "OPO" },
      { name: "Riyad", icao: "OERK", iata: "RUH" },
      { name: "Shanghai", icao: "ZSPD", iata: "PVG" },
      { name: "Shenzhen", icao: "ZGSZ", iata: "SZX" },
      { name: "Toulouse", icao: "LFBO", iata: "TLS" },
      { name: "Vitoria", icao: "LEVT", iata: "VIT" }
    ];

    function fetchViaProxy(url) {
      return fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`).then(res => {
        if (!res.ok) throw new Error("Netwerkfout");
        return res.text();
      });
    }

    function kleurCodeerTekst(tekst) {
      if (!tekst) return tekst;

      const fenomenen = [
        'TSRA','TS', 'thunderstorm', 'SN', 'snow', 'FG', 'fog', 'GR', 'hail', 'GS', 'small hail',
        'snow pellets', 'BR', 'mist', 'HZ', 'haze', 'FU', 'smoke', 'DS', 'duststorm', 'SS', 'sandstorm',
        'severe wind', 'FZ', 'freezing', 'VA', 'volcanic ash', 'DU', 'widespread dust', 'SQ', 'squall',
        'FC', 'funnel cloud', 'PO', 'dust devils', 'ice crystals', 'PL', 'ice pellets', 'SG', 'snow grains',
        'SA', 'sand', 'CB', 'cumulonimbus', 'TCU', 'towering cumulus', 'WS', 'wind shear'
      ];

      return tekst.split('\n').map(lijn => {
        if (/Weather:/i.test(lijn)) {
          const inhoud = lijn.split('Weather:')[1].trim().toLowerCase();
          const gevaarlijk = fenomenen.some(f => inhoud.includes(f.toLowerCase()));
          if (gevaarlijk) {
            return `<span style="color: red;">${lijn}</span>`;
          }
        }

        lijn = lijn.replace(/(Visibility:.*?\((\d+(?:\.\d+)?)\s+km\))/g, (match, fullMatch, km) => {
          const afstand = parseFloat(km);
          if (afstand <= 1) return `<span style="color: red;">${fullMatch}</span>`;
          if (afstand <= 2) return `<span style="color: orange;">${fullMatch}</span>`;
          return fullMatch;
        });

        lijn = lijn.replace(/(Ceiling:\s+(\d+)\s+feet\s+AGL)/g, (match, fullMatch, hoogte) => {
          const feet = parseInt(hoogte, 10);
          if (feet <= 200) return `<span style="color: red;">${fullMatch}</span>`;
          if (feet <= 400) return `<span style="color: orange;">${fullMatch}</span>`;
          return fullMatch;
        });

        lijn = lijn.replace(/(Winds:\s+from\s+\d+\s+degrees\s+at\s+(\d+)\s+knots)/g, (match, fullMatch, snelheid) => {
          const knots = parseInt(snelheid, 10);
          if (knots >= 30) return `<span style="color: red;">${fullMatch}</span>`;
          if (knots >= 25) return `<span style="color: orange;">${fullMatch}</span>`;
          return fullMatch;
        });

        return lijn;
      }).join('\n');
    }

    function fetchMetarTaf(icao, containerIdPrefix) {
      fetchViaProxy(`https://aviationweather.gov/cgi-bin/data/metar.php?ids=${icao}&format=decoded`)
        .then(data => {
          const gekleurd = kleurCodeerTekst(data);
          document.getElementById(`${containerIdPrefix}-metar`).innerHTML = gekleurd.replace(/\n/g, "<br>") || "Geen METAR beschikbaar.";
        })
        .catch(() => {
          document.getElementById(`${containerIdPrefix}-metar`).textContent = "Fout bij ophalen METAR.";
        });

      fetchViaProxy(`https://aviationweather.gov/cgi-bin/data/taf.php?ids=${icao}&format=decoded`)
        .then(data => {
          const gekleurd = kleurCodeerTekst(data);
          document.getElementById(`${containerIdPrefix}-taf`).innerHTML = gekleurd.replace(/\n/g, "<br>") || "Geen TAF beschikbaar.";
        })
        .catch(() => {
          document.getElementById(`${containerIdPrefix}-taf`).textContent = "Fout bij ophalen TAF.";
        });
    }

    function renderStation(title, icao, containerIdPrefix, container) {
      const div = document.createElement("div");
      div.className = "station";
      div.innerHTML = `<h2>${title}</h2>
        <p><strong>METAR:</strong></p>
        <pre id="${containerIdPrefix}-metar">Laden...</pre>
        <p><strong>TAF:</strong></p>
        <pre id="${containerIdPrefix}-taf">Laden...</pre>`;
      container.appendChild(div);
      fetchMetarTaf(icao, containerIdPrefix);
    }

    const selector = document.getElementById("stationsSelector");
    const output = document.getElementById("stationsOutput");

    stations.sort((a, b) => a.name.localeCompare(b.name)).forEach(station => {
      const btn = document.createElement("button");
      btn.textContent = `${station.name} (${station.iata})`;
      btn.className = "station-button";
      btn.addEventListener("click", () => {
        const idPrefix = `${station.icao}-${station.iata}`;
        if (!document.getElementById(`${idPrefix}-metar`)) {
          renderStation(`${station.name} (${station.iata})`, station.icao, idPrefix, output);
        }
      });
      selector.appendChild(btn);
    });

    function loadPreset(dag) {
      output.innerHTML = "";
      let preset = [];

      if (dag === "week") {
        preset = ["EBBR", "LFPG", "EGGW"];
      } else if (dag === "vrijdag") {
        preset = ["LIMC", "LOWL", "EDDP"];
      } else if (dag === "zondag") {
        preset = ["EGNX", "DNMM"];
      }

      preset.forEach(code => {
        const station = stations.find(s => s.icao === code);
        if (station) {
          const idPrefix = `preset-${station.icao}`;
          renderStation(`${station.name} (${station.iata})`, station.icao, idPrefix, output);
        }
      });
    }
  </script>
</body>
</html>