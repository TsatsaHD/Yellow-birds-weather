<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DHL Aviation – METAR & TAF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fffbe6;
      color: #8B0000;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #FFD700;
      padding: 20px;
      text-align: center;
      border-bottom: 5px solid #D2042D;
    }
    header h1 {
      margin: 0;
      color: #8B0000;
    }
    .search-container {
      display: flex;
      justify-content: center;
      padding: 20px;
      background-color: #fff4cc;
    }
    .search-container input {
      width: 600px;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #D2042D;
      border-radius: 5px;
    }
    .results {
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .station {
      background-color: #fff;
      border: 2px solid #D2042D;
      border-radius: 10px;
      padding: 15px;
      width: 300px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    .station h2 {
      margin-top: 0;
      color: #D2042D;
    }
    pre {
      white-space: pre-wrap;
      background: #fff8dc;
      padding: 10px;
      border-radius: 5px;
    }
    .loading {
      font-style: italic;
      color: gray;
    }
  </style>
</head>
<body>
  <header>
    <h1>DHL Aviation – Weerinfo</h1>
  </header>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Zoek op naam, ICAO of IATA. Meerdere gescheiden door komma (bv: Brussel, PVG, EBBR)" />
  </div>

  <div class="results" id="results"></div>

  <script>
    const stations = [
      { name: "Bahrein", icao: "OBBI", iata: "BAH" },
      { name: "Barcelona", icao: "LEBL", iata: "BCN" },
      { name: "Basel", icao: "LFSB", iata: "BSL" },
      { name: "Bologna", icao: "LIPE", iata: "BLQ" },
      { name: "Bordeaux", icao: "LFBD", iata: "BOD" },
      { name: "Brussel", icao: "EBBR", iata: "BRU" },
      { name: "Budapest", icao: "LHBP", iata: "BUD" },
      { name: "Casablanca", icao: "GMMN", iata: "CMN" },
      { name: "Shenzhen", icao: "ZGSZ", iata: "SZX" },
      { name: "Shanghai", icao: "ZSPD", iata: "PVG" },
      { name: "Cincinnati", icao: "KCVG", iata: "CVG" },
      { name: "Dublin", icao: "EIDW", iata: "DUB" },
      { name: "East-Midlands", icao: "EGNX", iata: "EMA" },
      { name: "Hongkong", icao: "VHHH", iata: "HKG" },
      { name: "Keulen", icao: "EDDK", iata: "CGN" },
      { name: "Kopenhagen", icao: "EKCH", iata: "CPH" },
      { name: "Lagos", icao: "DNMM", iata: "LOS" },
      { name: "Leipzig", icao: "EDDP", iata: "LEJ" },
      { name: "Linz", icao: "LOWL", iata: "LNZ" },
      { name: "London Luton", icao: "EGGW", iata: "LTN" },
      { name: "Lyon", icao: "LFLL", iata: "LYS" },
      { name: "Madrid", icao: "LEMD", iata: "MAD" },
      { name: "Malpensa", icao: "LIMC", iata: "MXP" },
      { name: "Marseille", icao: "LFML", iata: "MRS" },
      { name: "Mulhouse", icao: "LFSB", iata: "MLH" },
      { name: "Parijs Charles de Gaulle", icao: "LFPG", iata: "CDG" },
      { name: "Porto", icao: "LPPR", iata: "OPO" },
      { name: "Riyad", icao: "OERK", iata: "RUH" },
      { name: "Toulouse", icao: "LFBO", iata: "TLS" },
      { name: "Vitoria", icao: "LEVT", iata: "VIT" }
    ];

    const searchInput = document.getElementById('searchInput');
    const resultsDiv = document.getElementById('results');

    async function fetchViaProxy(url) {
      const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
      const data = await response.json();
      return JSON.parse(data.contents);
    }

    searchInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') {
        const query = searchInput.value.trim().toLowerCase().split(',').map(q => q.trim());
        const matchedStations = stations.filter(station =>
          query.some(q =>
            station.name.toLowerCase().includes(q) ||
            station.icao.toLowerCase() === q ||
            station.iata.toLowerCase() === q
          )
        );

        resultsDiv.innerHTML = '';
        if (matchedStations.length === 0) {
          resultsDiv.innerHTML = '<p>Geen resultaten gevonden.</p>';
          return;
        }

        for (const station of matchedStations) {
          const container = document.createElement('div');
          container.className = 'station';
          container.innerHTML = `<h2>${station.name} (${station.iata} / ${station.icao})</h2><p class="loading">Laden...</p>`;
          resultsDiv.appendChild(container);

          try {
            const metarData = await fetchViaProxy(`https://aviationweather.gov/api/data/metar?ids=${station.icao}&format=decoded`);
            const tafData = await fetchViaProxy(`https://aviationweather.gov/api/data/taf?ids=${station.icao}&format=decoded`);

            const metar = metarData[0] ? metarData[0].raw_text : 'Geen METAR gevonden.';
            const taf = tafData[0] ? tafData[0].raw_text : 'Geen TAF gevonden.';

            container.innerHTML = `
              <h2>${station.name} (${station.iata} / ${station.icao})</h2>
              <strong>METAR:</strong>
              <pre>${metar}</pre>
              <strong>TAF:</strong>
              <pre>${taf}</pre>
            `;
          } catch (error) {
            container.innerHTML = `<h2>${station.name} (${station.iata} / ${station.icao})</h2><p>Fout bij laden van METAR/TAF.</p>`;
          }
        }
      }
    });
  </script>
</body>
</html>