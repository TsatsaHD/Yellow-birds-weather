<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>DHL Aviation - METAR & TAF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fff8dc;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #ffcc00;
      color: #ba0c2f;
      padding: 1em;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    h1 {
      font-size: 1.8em;
      margin: 0;
    }
    .search-container {
      text-align: center;
      margin: 1em 0;
    }
    input[type="text"] {
      padding: 0.5em;
      width: 250px;
      border: 2px solid #ba0c2f;
      border-radius: 5px;
    }
    button {
      background-color: #ba0c2f;
      color: white;
      border: none;
      padding: 0.5em 1em;
      margin-left: 0.5em;
      border-radius: 5px;
      cursor: pointer;
    }
    .station {
      background-color: #fff;
      margin: 1em auto;
      max-width: 800px;
      border: 2px solid #ba0c2f;
      border-radius: 10px;
      padding: 1em;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    pre {
      background: #fff0c9;
      padding: 1em;
      overflow-x: auto;
      border-left: 4px solid #ba0c2f;
    }
    .loading {
      color: gray;
    }
  </style>
</head>
<body>
  <header>
    <h1>DHL Aviation - Weerinfo (METAR & TAF)</h1>
  </header>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Zoek op naam, IATA of ICAO">
    <button onclick="searchWeather()">Zoek</button>
  </div>

  <div id="searchResult"></div>

  <hr style="margin: 2em auto; width: 80%; border-color: #ba0c2f;">

  <div id="stations"></div>

  <script>
    const stations = [
      { name: "Bahrein",            icao: "OBBI", iata: "BAH" },
      { name: "Barcelona",          icao: "LEBL", iata: "BCN" },
      { name: "Basel",              icao: "LFSB", iata: "BSL" },
      { name: "Bologna",            icao: "LIPE", iata: "BLQ" },
      { name: "Bordeaux",           icao: "LFBD", iata: "BOD" },
      { name: "Brussel",            icao: "EBBR", iata: "BRU" },
      { name: "Budapest",           icao: "LHBP", iata: "BUD" },
      { name: "Casablanca",         icao: "GMMN", iata: "CMN" },
      { name: "Chengdu Tianfu",     icao: "ZUTF", iata: "TFU" },
      { name: "Cincinnati",         icao: "KCVG", iata: "CVG" },
      { name: "Dublin",             icao: "EIDW", iata: "DUB" },
      { name: "East-Midlands",      icao: "EGNX", iata: "EMA" },
      { name: "Hongkong",           icao: "VHHH", iata: "HKG" },
      { name: "Keulen",             icao: "EDDK", iata: "CGN" },
      { name: "Kopenhagen",         icao: "EKCH", iata: "CPH" },
      { name: "Lagos",              icao: "DNMM", iata: "LOS" },
      { name: "Leipzig",            icao: "EDDP", iata: "LEJ" },
      { name: "Linz",               icao: "LOWL", iata: "LNZ" },
      { name: "London Luton",       icao: "EGGW", iata: "LTN" },
      { name: "Lyon",               icao: "LFLL", iata: "LYS" },
      { name: "Madrid",             icao: "LEMD", iata: "MAD" },
      { name: "Malpensa",           icao: "LIMC", iata: "MXP" },
      { name: "Marseille",          icao: "LFML", iata: "MRS" },
      { name: "Mulhouse",           icao: "LFSB", iata: "MLH" },  // Alias voor Basel
      { name: "Parijs Charles de Gaulle", icao: "LFPG", iata: "CDG" },
      { name: "Porto",              icao: "LPPR", iata: "OPO" },
      { name: "Riyad",              icao: "OERK", iata: "RUH" },
      { name: "Toulouse",           icao: "LFBO", iata: "TLS" },
      { name: "Vitoria",            icao: "LEVT", iata: "VIT" }
    ];

    function fetchViaProxy(url) {
      const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
      return fetch(proxyUrl).then(response => {
        if (!response.ok) throw new Error("Netwerkfout");
        return response.text();
      });
    }

    function fetchMetarTaf(icao, containerIdPrefix) {
      fetchViaProxy(`https://aviationweather.gov/cgi-bin/data/metar.php?ids=${icao}&format=decoded`)
        .then(data => {
          document.getElementById(`${containerIdPrefix}-metar`).textContent = data || "Geen METAR beschikbaar.";
        })
        .catch(() => {
          document.getElementById(`${containerIdPrefix}-metar`).textContent = "Fout bij ophalen METAR.";
        });

      fetchViaProxy(`https://aviationweather.gov/cgi-bin/data/taf.php?ids=${icao}&format=decoded`)
        .then(data => {
          document.getElementById(`${containerIdPrefix}-taf`).textContent = data || "Geen TAF beschikbaar.";
        })
        .catch(() => {
          document.getElementById(`${containerIdPrefix}-taf`).textContent = "Fout bij ophalen TAF.";
        });
    }

    function renderStation(title, icao, containerIdPrefix, container) {
      const div = document.createElement("div");
      div.className = "station";
      div.innerHTML = `<h2>${title} (${icao})</h2>
        <p><strong>METAR:</strong></p>
        <pre id="${containerIdPrefix}-metar" class="loading">Laden...</pre>
        <p><strong>TAF:</strong></p>
        <pre id="${containerIdPrefix}-taf" class="loading">Laden...</pre>`;
      container.appendChild(div);
      fetchMetarTaf(icao, containerIdPrefix);
    }

    const stationContainer = document.getElementById("stations");
    stations.sort((a, b) => a.name.localeCompare(b.name)).forEach(station => {
      renderStation(`${station.name} (${station.iata})`, station.icao, station.icao + "-" + station.iata, stationContainer);
    });

    function searchWeather() {
      const input = document.getElementById("searchInput").value.trim().toUpperCase();
      const resultContainer = document.getElementById("searchResult");
      resultContainer.innerHTML = "";

      if (!input) {
        alert("Geef een geldige zoekterm in.");
        return;
      }

      let match = stations.find(s =>
        s.icao === input || s.iata === input || s.name.toUpperCase() === input
      );

      if (!match && input.length === 4) {
        match = { name: "Onbekend station", icao: input, iata: "?" };
      }

      if (!match) {
        alert("Geen station gevonden. Probeer een andere naam, IATA of ICAO-code.");
        return;
      }

      renderStation(`${match.name} (${match.iata})`, match.icao, `zoek-${match.icao}`, resultContainer);
    }
  </script>
</body>
</html>